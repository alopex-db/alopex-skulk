#!/bin/bash
# Discordé€šçŸ¥: ã‚³ãƒŸãƒƒãƒˆæ™‚ã«æŠ•ç¨¿

# ALOPEX_ROOTç’°å¢ƒå¤‰æ•°ã€ã¾ãŸã¯git toplevelã‹ã‚‰è¦ªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æ¢ç´¢
if [ -n "$ALOPEX_ROOT" ]; then
  SCRIPT_DIR="$ALOPEX_ROOT/scripts"
else
  # gitãƒªãƒã‚¸ãƒˆãƒªã®ãƒ«ãƒ¼ãƒˆã‹ã‚‰è¦ªã‚’è¾¿ã£ã¦scriptsã‚’æ¢ã™
  dir="$(git rev-parse --show-toplevel)"
  while [ "$dir" != "/" ]; do
    if [ -f "$dir/scripts/discord_notify.sh" ]; then
      SCRIPT_DIR="$dir/scripts"
      break
    fi
    dir="$(dirname "$dir")"
  done
fi

[ -z "$SCRIPT_DIR" ] && exit 0

# ã‚³ãƒŸãƒƒãƒˆæƒ…å ±ã‚’å–å¾—
COMMIT_HASH=$(git rev-parse --short HEAD)
COMMIT_MSG=$(git log -1 --pretty=%s)
BRANCH=$(git rev-parse --abbrev-ref HEAD)
AUTHOR=$(git log -1 --pretty=%an)

# Discordé€šçŸ¥
"$SCRIPT_DIR/discord_notify.sh" "ğŸ“ Commit: ${COMMIT_MSG}" "branch: ${BRANCH} | ${COMMIT_HASH} by ${AUTHOR}"
